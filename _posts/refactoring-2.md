---
title: '리팩터링 2장'
date: 2021-06-28 18:21:13
category: dev
published: false
---

## Chanpter 2. 리팩터링 원칙

### 리팩터링 정의

>앞으로 몇 시간은 리팩터링 할 것 같은데 그 사이에 적용하는 리팩터링은 수십 가지나 될 것 같다.

리팩터링(명사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법.

리팩터링(동사): 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

이러한 정의에 따르면, 리팩터링하는 동안에는 코드가 항상 정상 작동하기 때문에 전체 작업이 끝나지 않았더라도 언제든 멈출 수 있다. 누군가 "리팩터링하다가 코드가 깨져서 고생했다" 라고 말한다면, 십중팔구 리팩터링한 것이 아니다.

### 두 개의 모자

- 기능을 추가할 때는 기존 코드는 절대 건드리지 않고 새 기능을 추가하기만 한다. 이때의 진척도는 테스트를 추가해서 통과하는지 확인하는 방식으로 측정한다.
- 리팩터링할 때는 기능 추가는 절대 하지 않기로 다짐한 뒤 오로지 코드 재구성에만 전념한다. 테스트도 새로 만들지 않는다.
- 이 두 모드(모자에 비유) 중 자신이 어느 상태에 있는지 명확하게 인식하고 있어야한다.

### 리팩터링하는 이유

- 설계가 좋아진다. 실수 없이 더 적은 노력으로 수정할 수 있다.
- 코드는 컴퓨터 뿐 아니라 사람도 읽는다. 리팩터링은 더 이해하기 쉬운 코드를 만들어낸다.
- 버그를 쉽게 찾고 견고한 코드를 작성할 수 있다.
- 기능이 누적되면 될수록 리팩터링을 하는 것이 하지 않는 것보다 개발속도가 빠르다.
- 프로그램 요구사항이 바뀌고 기존 설계가 잘못되었다 하더라도(거의 항상 그렇다) 지속해서 개선할 수 있다.

### 언제 리팩터링해야 할까?

- 기능을 추가하려고 할 때
  
새 기능을 추가하기 쉽도록 코드를 수정하는 것이 그 기능을 가장 빠르게 추가하는 길일 수 있다.

- 버그를 수정하려고 할 때
  
오류를 일으키는 코드가 여러 군데에 복제되어 퍼져있다면, 우선 한 곳으로 합치는 편이 편하다.

- 코드를 이해하려고 하거나, 새로운 이해를 했을 때
  
리팩토링을 하다보면 이전에는 보이지 않던 설계가 보이기 시작하고, 코드의 의도에 대해 새롭게 알게 된 것들을 애써 기억하지 않아도 된다.

- 계획된 리팩터링이 무조건 나쁘다는 것은 아니지만, 대부분의 리팩터링 작업은 드러나지 않게 기회가 될 때마다 해야한다.

같은 이유로 리팩터링 커밋과 기능 추가 커밋을 분리하는 것도 무조건 좋은 것은 아니다. 리팩터링은 기능 추가와 밀접하게 관련되어 있므로 굳이 나누는 것이 부자연스러울 때가 많고, 맥락 정보가 없어서 왜 그렇게 수정했는지 잘 드러나지 않을 수도 있다.

- 팀 전체가 리팩터링에 매달리는 것보다는, 점진적으로 문제를 해결해나가는 편이 효과적일 때가 많다.

예를 들어 프로젝트에서 사용 중인 라이브러리를 교체할 때는 기존 것과 새 것 모두를 포용하는 추상 인터페이스부터 마련한다. 기존 코드가 이 추상 인터페이스를 호출하도록 만들고 나면 라이브러리 코드를 쉽게 교체할 수 있다. 이 전략을 [추상화로 갈아타기](https://martinfowler.com/bliki/BranchByAbstraction.html)라고 한다.

책 뒷 부분에 등장하는 함수 선언 바꾸기에도 비슷한 내용이 있다. 아래는 그 간단한 예시이다.

~~~js
function circum(radius) {
    return 2 * Math.PI * radius;
}

// 위 함수 이름을 circumference로 바꿔야한다면

function circumference(radius) {
    return 2 * Math.PI * radius;
}

function circum(radius) {
    return circumference(radius);
}

// 위와 같이 선언한 뒤 점진적으로 수정해나간다.
~~~

#### 코드 리뷰에 리팩터링 활용하기

코드 리뷰는 개발팀 전체에 지식을 전파하고 더 좋은 코드를 작성하는 데에 도움을 준다.
이 과정에서 새로운 아이디어를 단순히 제안하는 것에 그치지 않고 리팩터링을 해보면 큰 도움이 된다.
이 방법은 풀 리퀘스트를 검토하는 상황보다는 실제 코드 작성자와 함께 코드를 보는 상황에서 효과가 좋다.
후자처럼 하다보면 결국 짝 프로그래밍을 하는 것과 가깝게 된다.

#### 리팩터링하지 말아야 할 때

- 외부 API 다루듯 호출해서 쓰는 코드라면 지저분해도 리팩터링 할 필요 없다. 내부 동작을 이해해야 할 시점에 리팩터링해야 효과를 제대로 볼 수 있다.

- 리팩터링하는 것보다 처음부터 새로 작성하는 것이 쉬울 때도 리팩터링하지 않는다. 물론 이것을 해보지도 않고 판단하는 것은 어렵다.

### 리팩터링 시 고려할 문제

- 새 기능 개발 속도 저하

리팩터링을 클린코드나 바람직한 엔지니어링 습관처럼 도덕적인 이유로 정당화하지 말아야 한다. 리팩터링의 본질은 코드베이스를 예쁘게 꾸미는 데 있지 않다. 오로지 경제적인 이유로 하는 것이다. 리팩터링의 궁극적인 목적은 개발 속도를 높여서, 더 적은 노력으로 더 많은 가치를 창출하는 것이다.

- 코드 소유권
- 브랜치
- 테스팅
- 레거시 코드
- 데이터베이스

### 리팩터링, 아키텍처, 애그니

### 리팩터링과 소프트웨어 개발 프로세스

### 리팩터링과 성능

### 리팩터링의 유래

### 리팩터링 자동화

- 개발 도구가 해주는 리팩터링은 빠르고 안정적이라 따로 테스트할 필요가 없다.

- 하지만 언제나 그런 것은 아니다. 소스코드의 구문 트리를 이용하는 것이 아니라 텍스트를 직접 조작하는 방식이라면, 또는 해당 도구가 충분히 완성도가 높지 않다면 언제나 위험성은 존재한다.

- 당연히 정적 타입 언어가 자동화 리팩터링의 수혜를 더 크게 입는다. 따라서 정적 타입 언어를 사용할 때만이라도 텍스트 에디터 대신 IDE를 사용하는 것이 좋다.  
  
- 최근에는 언어 서버라는 기술이 뜨고 있는데, 이는 구문 트리를 구성에서 텍스트 에디터에 API 형태로 제공하는 소프트웨어이다.

### 더 알고 싶다면

- [리팩터링 워크북][리팩터링 워크북]은 리팩터링을 체화하게끔 연습에 주력한 책이다.
- [패턴을 활용한 리팩터링][패턴을 활용한 리팩터링]은 가장 핵심적인 디자인 패턴을 골라, 코드를 그 패턴대로 재구성하기 위해 리팩터링하는 방법을 다룬다.

[리팩터링 워크북]: http://www.yes24.com/Product/Goods/2148566?OzSrank=1
[패턴을 활용한 리팩터링]: http://www.yes24.com/Product/Goods/14752528?OzSrank=1
